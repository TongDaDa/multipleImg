{"dependencies":[],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar MATCH_ATTRIBUTE = /^dpr-[\\d]+$/;\nvar IMG_TIMEOUT = 5000;\nvar criticalValue = false;\n\n/**\n * @param {*} url\n * @return Promise\n * var loadImg = pingimgPromise(\"http://wwww.img.ong\").\n * then((success)=>{  },(err)=>{})\n */\nvar pingimgPromise = function pingimgPromise(url) {\n  var Img = new Image();\n  return new Promise(function (reslove, reject) {\n    Img.onload = function () {\n      reslove(\"success\");\n    };\n    Img.onerror = function () {\n      reject(\"error\");\n    };\n    setTimeout(function () {\n      reject(\"timeout\");\n    }, IMG_TIMEOUT);\n    Img.src = url;\n  });\n};\n\nvar arrayify = function arrayify(obj) {\n  return Array.prototype.slice.call(obj);\n};\n\n/**\n * @param ele\n * @return {Array}\n */\nvar getAttributeNames = function getAttributeNames(ele) {\n  var attrs = [],\n      matchAttrs = [];\n  if (ele.getAttributeNames) {\n    attrs = ele.getAttributeNames();\n  } else {\n    attrs = [].slice.call(ele.attributes);\n  }\n  for (var i = 0; i < attrs.length; i++) {\n    if (MATCH_ATTRIBUTE.test(attrs[i])) {\n      matchAttrs.push(attrs[i]);\n    }\n  }\n  return matchAttrs;\n};\n\nvar getGlobalImages = function getGlobalImages() {\n  var imagesArr = document.getElementsByTagName('img');\n  return arrayify(imagesArr);\n};\n\n/**\n * note: as DOMElement return multiple scale\n * @param ele\n * @return [{scale:Number,src:URL}]\n */\nvar getDprAttr = function getDprAttr(ele) {\n  var attrs = getAttributeNames(ele);\n  var drs = [];\n  for (var i = 0; i < attrs.length; ++i) {\n    drs.push({\n      scale: attrs[i].replace(/^dpr-/, \"\"),\n      src: ele.getAttribute(attrs[i])\n    });\n  }\n  return drs;\n};\n\nvar getDprRatio = function getDprRatio() {\n  if (window && window.devicePixelRatio) {\n    return Math.round(window.devicePixelRatio);\n  } else {\n    return 1;\n  }\n};\n\n/**\n * @param dprs{Array} ->> [{scale:Number,src:Source_URL}]\n * @param cb{Function} param1{}\n * @return\n */\nfunction matchDprSrc(dprs, cb) {\n  var rat = getDprRatio();\n  var matchDpr = [];\n  if (Array.isArray(dprs)) {\n    matchDpr = dprs.filter(function (imgItem) {\n      return rat === parseInt(imgItem.scale, 10);\n    });\n    if (matchDpr.length >= 1) {\n      cb && cb(matchDpr[0].src);\n    } else {\n      var positive = [],\n          negative = [];\n      var arr = dprs.map(function (imgItem) {\n        return { subTract: imgItem.scale - rat, src: imgItem.src };\n      });\n      for (var i = 0; i < arr.length; i++) {\n        if (arr[i] >= 0) {\n          positive.push(arr[i]);\n        } else {\n          negative.push(arr[i]);\n        }\n      }\n      matchDpr = criticalValue ? positive.sort(function (a, b) {\n        a = a.subTract;b = b.subTract;return a - b;\n      }) : negative.sort(function (a, b) {\n        a = a.subTract;b = b.subTract;return b - a;\n      });\n      cb && cb(matchDpr[0].src);\n    }\n  }\n}\n\n/**\n * @param ele{HTMLDOMElement}\n * @return undefined\n */\nvar clearAttribute = function clearAttribute(ele) {\n  var dprAttrs = getAttributeNames(ele);\n  for (var i = 0; i < dprAttrs.length; i++) {\n    ele.removeAttribute(dprAttrs[i]);\n  }\n};\n\n/**\n * @param images{Array|Object}?  HTMLImageElement\n * @param options{Object}? Object\n * @return undefined\n */\nfunction multipleImg(images) {\n  if (images) {\n    if (!Array.isArray(images)) {\n      images = [images];\n    }\n    images.forEach(function (image) {\n      var dprs = getDprAttr(image);\n      matchDprSrc(dprs, function (src) {\n        pingimgPromise(src).then(function () {\n          image.setAttribute('src', src);\n          clearAttribute(image);\n        }).catch(function (err) {\n          console.warn(\"multipleImg.js load img lose, use default src url\");\n          clearAttribute(image);\n        });\n      });\n    });\n  } else {\n    var globalImgs = getGlobalImages();\n    multipleImg(globalImgs);\n  }\n}\n\nif (window) {\n  window.addEventListener('load', function () {\n    window.multipleImg = multipleImg;\n  });\n}\n\nexports.default = multipleImg;"},"hash":"a21fb85648da8098d0a2bb8c8f8892cd"}